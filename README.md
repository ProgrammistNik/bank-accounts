# bank-accounts
–ó–∞–¥–∞–Ω–∏–µ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ C# –≤ –ú–æ–¥—É–ª—å–±–∞–Ω–∫:
–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å ¬´–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞¬ª, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–æ–∑–Ω–∏—á–Ω–æ–≥–æ –±–∞–Ω–∫–∞.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
    dotnet test
``` 
–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
 - –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –ø–æ—ç—Ç–æ–º—É –∏—Ö —Å—Ç–æ–∏—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Docker.
 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
- —á–µ—Ä–µ–∑ Docker

```bash
  docker compose up --build
```
- –õ–æ–∫–∞–ª—å–Ω–æ

```bash
  dotnet run
```
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: 

`http://0.0.0.0:8080/swagger/index.html`

## –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

`http://localhost:8081/realms/BankAccount/protocol/openid-connect/token`


### –ó–∞–≥–æ–ª–æ–≤–∫–∏
- `Content-Type: application/x-www-form-urlencoded`

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (form-data –∏–ª–∏ x-www-form-urlencoded):
| –ü–∞—Ä–∞–º–µ—Ç—Ä      | –ó–Ω–∞—á–µ–Ω–∏–µ           | –û–ø–∏—Å–∞–Ω–∏–µ               |
|---------------|--------------------|------------------------|
| grant_type    | client_credentials | –¢–∏–ø –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞   |
| client_id     | AccountClient      | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞  |
| client_secret | my-secret          | –°–µ–∫—Ä–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞         |

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—à–Ω—ã–π `HTTP 200 OK`):
```json
{
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 300,
  "refresh_expires_in": 0,
  "token_type": "Bearer",
  "not-before-policy": 0,
  "scope": "profile email"
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Hangfire
–ü–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Hangfire —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

`http://0.0.0.0:8080/hangfire`

## RabbitMQ
–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RabbitMQ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

`http://localhost:15672/`

`admin` - –ª–æ–≥–∏–Ω
`password` - –ø–∞—Ä–æ–ª—å

–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è AntifraudConsumer:

`Routing Key: client.unblocked`

```json
 {
  "eventId": "0e697796-6128-4c9c-8b47-9ddc01affd7b",
  "occurredAt": "2025-08-15T12:00:00Z",
  "payload": {
    "ownerId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
    "clientId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
    "status": "Unblocked"
  },
  "meta": {
    "version": "v1",
    "source": "test-client",
    "correlationId": "eb61ed5a-8f41-4717-8b39-0ecc0d606615",
    "causationId": "85b2b573-6ac9-455f-86e2-a98f8bf56b89"
  }
}
```

–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è RabbitMQ, –≤ —Ä–∞–∑–¥–µ–ª–µ "Exchanges" –≤—ã–±–µ—Ä–∏—Ç–µ `account.events`, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Publish message". –í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –∏ –Ω–∞–∂–º–∏—Ç–µ "Publish message".

## –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

–ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –æ—à–∏–±–∫–∞ Npgsql.PostgresException : 28P01. –î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ `appsettings.json` –Ω–∞ –ø–∞—Ä–æ–ª—å –æ—Ç –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
